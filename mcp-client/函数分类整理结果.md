# MCP Client å‡½æ•°åˆ†ç±»æ•´ç†ç»“æœ

## ğŸ“ æ–‡ä»¶ç»“æ„é‡æ–°æ•´ç†

å·²å¯¹ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒ MCP Client æ–‡ä»¶è¿›è¡Œäº†å‡½æ•°é‡æ–°æ’åºï¼ŒæŒ‰åŠŸèƒ½åˆ†ç»„ä¾¿äºæŸ¥çœ‹ï¼š

### 1. MCPSseClient.java (SSE ä¼ è¾“åè®®å®ç°)

```
ğŸ”— è¿æ¥å»ºç«‹ç›¸å…³å‡½æ•°
â”œâ”€â”€ initializeConnection()          - åˆå§‹åŒ– SSE è¿æ¥
â”œâ”€â”€ determineSseUri()              - ç¡®å®š SSE ç«¯ç‚¹ URI
â”œâ”€â”€ performHandshake()             - æ‰§è¡Œæ¡æ‰‹åè®®
â””â”€â”€ isConnected()                  - æ£€æŸ¥è¿æ¥çŠ¶æ€

ğŸ“¡ æ¶ˆæ¯ä¼ è¾“ç›¸å…³å‡½æ•°
â”œâ”€â”€ handleServerEvent()            - å¤„ç†æœåŠ¡å™¨äº‹ä»¶
â”œâ”€â”€ handleTypedEvent()             - å¤„ç†ç‰¹å®šç±»å‹äº‹ä»¶
â”œâ”€â”€ handleEndpointEvent()          - å¤„ç†ç«¯ç‚¹äº‹ä»¶
â”œâ”€â”€ handleDirectEndpointEvent()    - å¤„ç†ç›´æ¥ç«¯ç‚¹äº‹ä»¶
â”œâ”€â”€ handleMessageEvent()           - å¤„ç†æ¶ˆæ¯äº‹ä»¶
â”œâ”€â”€ sendRequest()                  - å‘é€è¯·æ±‚
â”œâ”€â”€ sendRequestInternal()          - å†…éƒ¨å‘é€è¯·æ±‚
â”œâ”€â”€ sendNotification()             - å‘é€é€šçŸ¥
â”œâ”€â”€ sendNotificationInternal()     - å†…éƒ¨å‘é€é€šçŸ¥
â””â”€â”€ calculateRequestUri()          - è®¡ç®—è¯·æ±‚URI

ğŸ”„ è¿æ¥é‡è¯•ä¸æ¢å¤ç›¸å…³å‡½æ•°
â”œâ”€â”€ handleConnectionError()        - å¤„ç†è¿æ¥é”™è¯¯
â”œâ”€â”€ attemptReconnection()          - å°è¯•é‡æ–°è¿æ¥
â””â”€â”€ initializeConnectionInternal() - å†…éƒ¨è¿æ¥åˆå§‹åŒ–

ğŸ’“ å¿ƒè·³ä¿æ´»ç›¸å…³å‡½æ•°
â”œâ”€â”€ createHeartbeatExecutor()      - åˆ›å»ºå¿ƒè·³çº¿ç¨‹æ± 
â”œâ”€â”€ startHeartbeat()               - å¯åŠ¨å¿ƒè·³æ£€æµ‹
â”œâ”€â”€ performHeartbeat()             - æ‰§è¡Œå¿ƒè·³æ£€æµ‹
â”œâ”€â”€ buildPingRequest()             - æ„å»ºå¿ƒè·³è¯·æ±‚
â”œâ”€â”€ sendHeartbeatRequest()         - å‘é€å¿ƒè·³è¯·æ±‚
â”œâ”€â”€ handleHeartbeatError()         - å¤„ç†å¿ƒè·³é”™è¯¯
â””â”€â”€ stopHeartbeat()                - åœæ­¢å¿ƒè·³æ£€æµ‹

ğŸ”§ å·¥å…·è°ƒç”¨ç›¸å…³å‡½æ•°
â”œâ”€â”€ callTool()                     - è°ƒç”¨å·¥å…·
â””â”€â”€ getTools()                     - è·å–å·¥å…·åˆ—è¡¨

ğŸ”š è¿æ¥å…³é—­ä¸æ¸…ç†ç›¸å…³å‡½æ•°
â”œâ”€â”€ disconnect()                   - æ–­å¼€è¿æ¥
â””â”€â”€ close()                        - å…³é—­å®¢æˆ·ç«¯
```

### 2. MCPStdioClient.java (STDIO ä¼ è¾“åè®®å®ç°)

```
ğŸ”— è¿æ¥å»ºç«‹ç›¸å…³å‡½æ•°
â”œâ”€â”€ initializeProcess()            - åˆå§‹åŒ–å­è¿›ç¨‹
â”œâ”€â”€ startErrorStreamMonitor()      - å¯åŠ¨é”™è¯¯æµç›‘æ§
â”œâ”€â”€ performHandshake()             - æ‰§è¡Œæ¡æ‰‹åè®®
â”œâ”€â”€ isConnected()                  - æ£€æŸ¥è¿æ¥çŠ¶æ€
â””â”€â”€ isProcessAlive()               - æ£€æŸ¥è¿›ç¨‹æ˜¯å¦å­˜æ´»

ğŸ“¡ æ¶ˆæ¯ä¼ è¾“ç›¸å…³å‡½æ•°
â”œâ”€â”€ readJsonResponse()             - è¯»å–JSONå“åº”
â”œâ”€â”€ isJsonLine()                   - æ£€æŸ¥æ˜¯å¦ä¸ºJSONæ ¼å¼
â”œâ”€â”€ sendRequest()                  - å‘é€è¯·æ±‚
â””â”€â”€ sendNotification()             - å‘é€é€šçŸ¥

ğŸ”§ å·¥å…·è°ƒç”¨ç›¸å…³å‡½æ•°
â”œâ”€â”€ callTool()                     - è°ƒç”¨å·¥å…·
â””â”€â”€ getTools()                     - è·å–å·¥å…·åˆ—è¡¨

ğŸ”š è¿æ¥å…³é—­ä¸æ¸…ç†ç›¸å…³å‡½æ•°
â”œâ”€â”€ disconnect()                   - æ–­å¼€è¿æ¥
â”œâ”€â”€ close()                        - å…³é—­å®¢æˆ·ç«¯
â””â”€â”€ cleanup()                      - æ¸…ç†èµ„æº
```

### 3. AbstractMCPClient.java (æŠ½è±¡åŸºç±»)

```
ğŸ”— è¿æ¥çŠ¶æ€ç›¸å…³å‡½æ•°
â”œâ”€â”€ getServerInfo()                - è·å–æœåŠ¡å™¨ä¿¡æ¯
â””â”€â”€ isConnected()                  - æ£€æŸ¥è¿æ¥çŠ¶æ€

ğŸ“ è¯·æ±‚æ„å»ºç›¸å…³å‡½æ•°
â”œâ”€â”€ buildToolCallRequest()         - æ„å»ºå·¥å…·è°ƒç”¨è¯·æ±‚
â”œâ”€â”€ buildListToolsRequest()        - æ„å»ºå·¥å…·åˆ—è¡¨è¯·æ±‚
â”œâ”€â”€ buildInitializeRequest()       - æ„å»ºåˆå§‹åŒ–è¯·æ±‚
â”œâ”€â”€ buildInitializedNotification() - æ„å»ºåˆå§‹åŒ–å®Œæˆé€šçŸ¥
â”œâ”€â”€ buildListResourcesRequest()    - æ„å»ºèµ„æºåˆ—è¡¨è¯·æ±‚
â”œâ”€â”€ buildReadResourceRequest()     - æ„å»ºè¯»å–èµ„æºè¯·æ±‚
â”œâ”€â”€ buildListPromptsRequest()      - æ„å»ºæç¤ºåˆ—è¡¨è¯·æ±‚
â””â”€â”€ buildGeneratePromptRequest()   - æ„å»ºç”Ÿæˆæç¤ºè¯·æ±‚

ğŸ“Š å“åº”è§£æç›¸å…³å‡½æ•°
â”œâ”€â”€ parseInitializeResponse()      - è§£æåˆå§‹åŒ–å“åº”
â”œâ”€â”€ parseToolResult()              - è§£æå·¥å…·ç»“æœ
â”œâ”€â”€ parseToolsList()               - è§£æå·¥å…·åˆ—è¡¨
â”œâ”€â”€ parseResourcesList()           - è§£æèµ„æºåˆ—è¡¨
â”œâ”€â”€ parseResourceContent()         - è§£æèµ„æºå†…å®¹
â”œâ”€â”€ parsePromptsList()             - è§£ææç¤ºåˆ—è¡¨
â”œâ”€â”€ parsePromptResponse()          - è§£ææç¤ºå“åº”
â””â”€â”€ parseGeneratedPrompt()         - è§£æç”Ÿæˆçš„æç¤º

ğŸ“ èµ„æºç®¡ç†ç›¸å…³å‡½æ•°
â”œâ”€â”€ getResources()                 - è·å–èµ„æºåˆ—è¡¨
â”œâ”€â”€ readResource()                 - è¯»å–èµ„æº
â”œâ”€â”€ getPrompts()                   - è·å–æç¤ºåˆ—è¡¨
â”œâ”€â”€ generatePrompt()               - ç”Ÿæˆæç¤º
â””â”€â”€ getPrompt()                    - è·å–æç¤º

ğŸ”§ æŠ½è±¡æ–¹æ³•å®šä¹‰
â”œâ”€â”€ validateResponse()             - éªŒè¯å“åº”
â”œâ”€â”€ performHandshake()             - æ‰§è¡Œæ¡æ‰‹åè®®ï¼ˆæŠ½è±¡ï¼‰
â””â”€â”€ sendRequest()                  - å‘é€è¯·æ±‚ï¼ˆæŠ½è±¡ï¼‰
```

## ğŸ¯ æ•´ç†æ•ˆæœ

### âœ… ä¼˜åŒ–æˆæœ
1. **é€»è¾‘åˆ†ç»„**: æŒ‰åŠŸèƒ½å°†ç›¸å…³å‡½æ•°å½’ç±»ï¼Œä¾¿äºç†è§£å’Œç»´æŠ¤
2. **æ¸…æ™°æ³¨é‡Š**: æ·»åŠ äº†åŠŸèƒ½åˆ†ç»„çš„æ³¨é‡Šæ ‡è¯†
3. **æ¶ˆé™¤é‡å¤**: åˆ é™¤äº†é‡å¤çš„å‡½æ•°å®šä¹‰
4. **ç»Ÿä¸€ç»“æ„**: ä¸‰ä¸ªæ–‡ä»¶éƒ½é‡‡ç”¨äº†ç›¸åŒçš„åˆ†ç»„é€»è¾‘

### ğŸ“‹ åˆ†ç»„è¯´æ˜
- **è¿æ¥å»ºç«‹**: åˆå§‹åŒ–è¿æ¥ã€æ¡æ‰‹åè®®ã€çŠ¶æ€æ£€æŸ¥
- **æ¶ˆæ¯ä¼ è¾“**: è¯·æ±‚å‘é€ã€å“åº”å¤„ç†ã€äº‹ä»¶å¤„ç†
- **å¿ƒè·³ä¿æ´»**: å¿ƒè·³æ£€æµ‹ã€é”™è¯¯å¤„ç†ã€è¿æ¥ç»´æŠ¤
- **å·¥å…·è°ƒç”¨**: å·¥å…·æ‰§è¡Œã€ç»“æœè§£æ
- **è¿æ¥é‡è¯•**: é”™è¯¯æ¢å¤ã€é‡è¿æœºåˆ¶
- **èµ„æºç®¡ç†**: èµ„æºæ“ä½œã€æç¤ºæ¨¡æ¿
- **è¿æ¥å…³é—­**: æ–­å¼€è¿æ¥ã€èµ„æºæ¸…ç†

### ğŸ” æŸ¥çœ‹å»ºè®®
ç°åœ¨å¼€å‘è€…å¯ä»¥ï¼š
1. å¿«é€Ÿå®šä½ç‰¹å®šåŠŸèƒ½çš„å‡½æ•°
2. ç†è§£å„åŠŸèƒ½æ¨¡å—çš„èŒè´£
3. æ›´å®¹æ˜“è¿›è¡Œä»£ç ç»´æŠ¤å’Œæ‰©å±•
4. å‡å°‘åœ¨å¤§æ–‡ä»¶ä¸­æŸ¥æ‰¾å‡½æ•°çš„æ—¶é—´

è¿™ç§é‡æ–°æ•´ç†ä½¿å¾— MCP Client çš„ä»£ç ç»“æ„æ›´åŠ æ¸…æ™°ï¼Œä¾¿äºå¼€å‘å’Œç»´æŠ¤ã€‚
