# MCP Client 函数分类整理结果

## 📁 文件结构重新整理

已对以下三个核心 MCP Client 文件进行了函数重新排序，按功能分组便于查看：

### 1. MCPSseClient.java (SSE 传输协议实现)

```
🔗 连接建立相关函数
├── initializeConnection()          - 初始化 SSE 连接
├── determineSseUri()              - 确定 SSE 端点 URI
├── performHandshake()             - 执行握手协议
└── isConnected()                  - 检查连接状态

📡 消息传输相关函数
├── handleServerEvent()            - 处理服务器事件
├── handleTypedEvent()             - 处理特定类型事件
├── handleEndpointEvent()          - 处理端点事件
├── handleDirectEndpointEvent()    - 处理直接端点事件
├── handleMessageEvent()           - 处理消息事件
├── sendRequest()                  - 发送请求
├── sendRequestInternal()          - 内部发送请求
├── sendNotification()             - 发送通知
├── sendNotificationInternal()     - 内部发送通知
└── calculateRequestUri()          - 计算请求URI

🔄 连接重试与恢复相关函数
├── handleConnectionError()        - 处理连接错误
├── attemptReconnection()          - 尝试重新连接
└── initializeConnectionInternal() - 内部连接初始化

💓 心跳保活相关函数
├── createHeartbeatExecutor()      - 创建心跳线程池
├── startHeartbeat()               - 启动心跳检测
├── performHeartbeat()             - 执行心跳检测
├── buildPingRequest()             - 构建心跳请求
├── sendHeartbeatRequest()         - 发送心跳请求
├── handleHeartbeatError()         - 处理心跳错误
└── stopHeartbeat()                - 停止心跳检测

🔧 工具调用相关函数
├── callTool()                     - 调用工具
└── getTools()                     - 获取工具列表

🔚 连接关闭与清理相关函数
├── disconnect()                   - 断开连接
└── close()                        - 关闭客户端
```

### 2. MCPStdioClient.java (STDIO 传输协议实现)

```
🔗 连接建立相关函数
├── initializeProcess()            - 初始化子进程
├── startErrorStreamMonitor()      - 启动错误流监控
├── performHandshake()             - 执行握手协议
├── isConnected()                  - 检查连接状态
└── isProcessAlive()               - 检查进程是否存活

📡 消息传输相关函数
├── readJsonResponse()             - 读取JSON响应
├── isJsonLine()                   - 检查是否为JSON格式
├── sendRequest()                  - 发送请求
└── sendNotification()             - 发送通知

🔧 工具调用相关函数
├── callTool()                     - 调用工具
└── getTools()                     - 获取工具列表

🔚 连接关闭与清理相关函数
├── disconnect()                   - 断开连接
├── close()                        - 关闭客户端
└── cleanup()                      - 清理资源
```

### 3. AbstractMCPClient.java (抽象基类)

```
🔗 连接状态相关函数
├── getServerInfo()                - 获取服务器信息
└── isConnected()                  - 检查连接状态

📝 请求构建相关函数
├── buildToolCallRequest()         - 构建工具调用请求
├── buildListToolsRequest()        - 构建工具列表请求
├── buildInitializeRequest()       - 构建初始化请求
├── buildInitializedNotification() - 构建初始化完成通知
├── buildListResourcesRequest()    - 构建资源列表请求
├── buildReadResourceRequest()     - 构建读取资源请求
├── buildListPromptsRequest()      - 构建提示列表请求
└── buildGeneratePromptRequest()   - 构建生成提示请求

📊 响应解析相关函数
├── parseInitializeResponse()      - 解析初始化响应
├── parseToolResult()              - 解析工具结果
├── parseToolsList()               - 解析工具列表
├── parseResourcesList()           - 解析资源列表
├── parseResourceContent()         - 解析资源内容
├── parsePromptsList()             - 解析提示列表
├── parsePromptResponse()          - 解析提示响应
└── parseGeneratedPrompt()         - 解析生成的提示

📁 资源管理相关函数
├── getResources()                 - 获取资源列表
├── readResource()                 - 读取资源
├── getPrompts()                   - 获取提示列表
├── generatePrompt()               - 生成提示
└── getPrompt()                    - 获取提示

🔧 抽象方法定义
├── validateResponse()             - 验证响应
├── performHandshake()             - 执行握手协议（抽象）
└── sendRequest()                  - 发送请求（抽象）
```

## 🎯 整理效果

### ✅ 优化成果
1. **逻辑分组**: 按功能将相关函数归类，便于理解和维护
2. **清晰注释**: 添加了功能分组的注释标识
3. **消除重复**: 删除了重复的函数定义
4. **统一结构**: 三个文件都采用了相同的分组逻辑

### 📋 分组说明
- **连接建立**: 初始化连接、握手协议、状态检查
- **消息传输**: 请求发送、响应处理、事件处理
- **心跳保活**: 心跳检测、错误处理、连接维护
- **工具调用**: 工具执行、结果解析
- **连接重试**: 错误恢复、重连机制
- **资源管理**: 资源操作、提示模板
- **连接关闭**: 断开连接、资源清理

### 🔍 查看建议
现在开发者可以：
1. 快速定位特定功能的函数
2. 理解各功能模块的职责
3. 更容易进行代码维护和扩展
4. 减少在大文件中查找函数的时间

这种重新整理使得 MCP Client 的代码结构更加清晰，便于开发和维护。
